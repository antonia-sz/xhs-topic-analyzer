<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>小红书选题分析助手</title>
  <link rel="stylesheet" href="styles.css">
  <script src="lib/marked.min.js"></script>
  <script src="lib/xlsx.full.min.js"></script>
  <script src="config.js"></script>
</head>
<body>
  <div class="container">

    <!-- ==================== 视图1：分析页 ==================== -->
    <div id="mainView" class="view active">
      <!-- Header -->
      <header class="header">
        <div class="header-row">
          <div>
            <h1 class="header-title">小红书选题分析助手</h1>
            <p class="header-subtitle">Deepseek · AI 分析</p>
          </div>
          <button id="goStagingBtn" class="btn-nav" title="暂存区与导出">
            <svg class="btn-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            <span id="stagingBadge" class="badge hidden">0</span>
          </button>
        </div>
      </header>

      <!-- 操作区 -->
      <div class="action-section">
        <button id="extractBtn" class="btn btn-primary">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10 9 9 9 8 9"></polyline>
          </svg>
          提取主题
        </button>
        <button id="analyzeBtn" class="btn btn-secondary" disabled>
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path>
            <path d="M5 3v4"></path>
            <path d="M19 17v4"></path>
            <path d="M3 5h4"></path>
            <path d="M17 19h4"></path>
          </svg>
          分析选题
        </button>
        <button id="reanalyzeBtn" class="btn btn-tertiary" disabled>
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="1 4 1 10 7 10"></polyline>
            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
          </svg>
          重新分析
        </button>
      </div>

      <!-- 提示信息 -->
      <div id="tipMessage" class="tip-message"></div>

      <!-- 状态指示器 -->
      <div id="statusIndicator" class="status-indicator">
        <div id="statusTitle" class="status-item">
          <span class="status-icon status-pending"></span>
          <span class="status-text">待提取标题</span>
        </div>
        <div id="statusDesc" class="status-item">
          <span class="status-icon status-pending"></span>
          <span class="status-text">待提取正文</span>
        </div>
      </div>

      <!-- 提取内容预览 -->
      <div id="extractedContent" class="extracted-content"></div>

      <!-- 思考状态 -->
      <div id="thinkingStatus" class="thinking-status">
        <div class="thinking-spinner"></div>
        <span>正在分析中…</span>
      </div>

      <!-- 分析结果 -->
      <div class="result-section" id="resultSection">
        <div id="resultHeader" class="result-header">
          <svg class="result-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
          </svg>
          <span>分析结果</span>
        </div>
        <div id="analysisResult" class="analysis-result"></div>
        <!-- 加入暂存区按钮 -->
        <button id="addToStagingBtn" class="btn btn-staging hidden">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"></path>
            <path d="m3.3 7 8.7 5 8.7-5"></path>
            <path d="M12 22V12"></path>
          </svg>
          加入暂存区
        </button>
      </div>
    </div>

    <!-- ==================== 视图2：暂存区列表 ==================== -->
    <div id="stagingView" class="view">
      <header class="header">
        <div class="header-row">
          <button id="backToMainBtn" class="btn-back" title="返回">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m15 18-6-6 6-6"></path>
            </svg>
          </button>
          <div>
            <h1 class="header-title">暂存区</h1>
            <p class="header-subtitle" id="stagingCount">共 0 条记录（上限 100 条）</p>
          </div>
        </div>
      </header>

      <!-- 暂存区操作栏 -->
      <div class="staging-toolbar">
        <label class="checkbox-wrapper">
          <input type="checkbox" id="selectAllCheckbox">
          <span class="checkbox-label">全选</span>
        </label>
        <div class="staging-toolbar-actions">
          <button id="exportSelectedBtn" class="btn-toolbar-icon btn-toolbar-export" disabled title="导出Excel">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
          </button>
          <button id="deleteSelectedBtn" class="btn-toolbar-icon btn-toolbar-delete" disabled title="删除">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 6h18"></path>
              <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
              <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- 暂存记录列表 -->
      <div id="stagingList" class="staging-list">
        <div class="staging-empty">
          <svg class="staging-empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"></path>
            <path d="m3.3 7 8.7 5 8.7-5"></path>
            <path d="M12 22V12"></path>
          </svg>
          <p>暂存区为空</p>
          <p class="staging-empty-hint">分析笔记后点击「加入暂存区」添加记录</p>
        </div>
      </div>
    </div>

    <!-- ==================== 视图3：暂存详情 ==================== -->
    <div id="detailView" class="view">
      <header class="header">
        <div class="header-row">
          <button id="backToStagingBtn" class="btn-back" title="返回暂存区">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m15 18-6-6 6-6"></path>
            </svg>
          </button>
          <div class="header-title-wrap">
            <h1 class="header-title" id="detailTitle">笔记详情</h1>
            <p class="header-subtitle" id="detailTime"></p>
          </div>
        </div>
      </header>

      <!-- 详情信息 -->
      <div class="detail-meta">
        <div class="detail-meta-item">
          <span class="detail-meta-label">链接</span>
          <a id="detailUrl" class="detail-meta-link" href="#" target="_blank">查看原文</a>
        </div>
        <label class="checkbox-wrapper detail-checkbox">
          <input type="checkbox" id="detailCheckbox">
          <span class="checkbox-label">选中此记录用于导出</span>
        </label>
      </div>

      <!-- 详情分析内容 -->
      <div id="detailContent" class="detail-analysis-content"></div>

      <!-- 详情页操作 -->
      <div class="detail-actions">
        <button id="deleteRecordBtn" class="btn btn-danger-outline">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 6h18"></path>
            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
          </svg>
          删除此记录
        </button>
      </div>
    </div>

  </div>

  <script src="sidepanel.js"></script>
</body>
</html>
